# Docker Compose для OCR Service v2
#
# Единый контейнер с FastAPI + Tesseract + Poppler.
# Не требует Python или Tesseract на хосте.
#
# Использование:
#   docker-compose up --build -d
#
#   # Отправить PDF:
#   curl -X POST http://localhost:8000/ocr/execute -F "file=@test.pdf"

services:
  ocr-service:
    build: .
    image: tesseract-ocr-service
    container_name: tesseract-ocr-service
    ports:
      - "${OCR_PORT:-8000}:${OCR_PORT:-8000}"
    env_file:
      - .env
    deploy:
      resources:
        limits:
          cpus: "8"
          memory: 8G
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:${OCR_PORT:-8000}/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 15s
    restart: unless-stopped
