# =============================================================================
# КОНФИГУРАЦИЯ OCR SERVICE v2
# =============================================================================
# Скопируйте этот файл в .env и настройте под своё окружение:
#   cp .env.example .env
#
# Все параметры читаются автоматически через pydantic-settings.
# Единый префикс: OCR_
# Изменения в .env применяются после перезапуска сервиса.
# =============================================================================


# =============================================================================
# СЕРВЕР
# =============================================================================

# Порт на котором будет доступен сервис
# Девопс указывает свободный порт на сервере
OCR_PORT=8000


# =============================================================================
# API: лимиты загрузки
# =============================================================================

# Максимальный размер загружаемого PDF (МБ)
OCR_MAX_FILE_SIZE_MB=100


# =============================================================================
# SPLIT: Конвертация PDF -> изображения (pdf2image/pdftoppm)
# =============================================================================

# DPI рендеринга PDF (влияет на качество и скорость)
# - 150: быстро, низкое качество
# - 300: стандарт для OCR (рекомендуется)
# - 400+: медленно, для мелкого текста
OCR_RENDER_DPI=300

# Количество потоков для pdftoppm (параллельный рендеринг страниц)
# Рекомендуется: количество CPU ядер
OCR_RENDER_THREAD_COUNT=8

# Формат выходных изображений: jpeg (быстрее) или png (без потерь)
OCR_RENDER_FORMAT=jpeg


# =============================================================================
# OSD: Определение ориентации текста (Orientation & Script Detection)
# =============================================================================

# Процент кропа от краёв для OSD анализа (0.15 = 15% с каждой стороны)
# Убирает шум от сканера (чёрные полосы, артефакты)
# Результат: анализируется центральные 70% изображения
OCR_OSD_CROP_PERCENT=0.15

# Размер изображения для OSD в пикселях (ресайз перед анализом)
# - 1024: быстро, может терять точность
# - 2048: баланс скорость/точность (рекомендуется)
# - 4096: точно, но медленно
OCR_OSD_RESIZE_PX=2048

# Минимальная уверенность OSD для применения поворота (0-100)
# Если confidence ниже — поворот не применяется
# - 5.0: применять почти всегда (текущее значение)
# - 50.0: применять только при высокой уверенности
OCR_OSD_CONFIDENCE_THRESHOLD=5.0


# =============================================================================
# DESKEW: Коррекция наклона текста
# =============================================================================

# Размер изображения для deskew анализа в пикселях
OCR_DESKEW_RESIZE_PX=1200

# Количество пиков для алгоритма определения наклона
OCR_DESKEW_NUM_PEAKS=20

# Минимальный угол наклона для применения коррекции (градусы)
# Если угол меньше — коррекция не применяется (избегаем лишних трансформаций)
OCR_SKEW_THRESHOLD=0.3


# =============================================================================
# OCR: Распознавание текста (Tesseract)
# =============================================================================

# OCR Engine Mode (OEM):
# - 0: Legacy engine only
# - 1: Neural nets LSTM engine only
# - 2: Legacy + LSTM engines
# - 3: Default (LSTM if available, else Legacy) — рекомендуется
OCR_OCR_OEM=3

# Page Segmentation Mode (PSM):
# - 3: Fully automatic page segmentation (no OSD)
# - 4: Assume single column of text
# - 6: Assume uniform block of text — рекомендуется для документов
# - 11: Sparse text (find as much text as possible)
# - 13: Raw line (treat image as single text line)
OCR_OCR_PSM=6
